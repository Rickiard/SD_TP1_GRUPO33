@{
    ViewData["Title"] = "Análise Avançada de Dados";
}

<div class="dashboard-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="hero-title">
                        <i class="bi bi-graph-up-arrow text-primary me-3"></i>
                        Análise Avançada de Dados
                    </h1>
                    <p class="hero-subtitle">Análise personalizada dos dados oceanográficos com filtros específicos</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="status-indicator">
                        <span class="status-dot online"></span>
                        <span class="status-text">Sistema Analítico</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid" style="padding-top: 2rem;">
        <!-- Analysis Configuration Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card filters-card shadow-lg border-0">
                    <div class="card-header bg-gradient-primary text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0" style="color:white">
                                <i class="bi bi-sliders me-2"></i>
                                Configuração da Análise
                            </h5>
                            <div class="analysis-status">
                                <span class="badge bg-light text-dark">
                                    <i class="bi bi-cpu me-1"></i>
                                    Pronto para Análise
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <!-- Analysis Presets -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="bi bi-bookmark-star me-2"></i>
                                    Análises Predefinidas
                                </h6>
                                <div class="row g-3" id="analysisPresets">
                                    <!-- Presets will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Custom Filters -->
                        <form id="analysisForm" class="analysis-form">
                            <div class="row g-4">
                                <!-- Time Range -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label for="startDate" class="form-label fw-semibold text-primary">
                                            <i class="bi bi-calendar-event me-1"></i>
                                            Data Início
                                        </label>
                                        <input type="datetime-local" class="form-control" id="startDate" name="startDate" required>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label for="endDate" class="form-label fw-semibold text-primary">
                                            <i class="bi bi-calendar-check me-1"></i>
                                            Data Fim
                                        </label>
                                        <input type="datetime-local" class="form-control" id="endDate" name="endDate" required>
                                    </div>
                                </div>

                                <!-- Station Filter -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label for="stationFilter" class="form-label fw-semibold text-primary">
                                            <i class="bi bi-geo-alt me-1"></i>
                                            Estações
                                        </label>
                                        <select class="form-select" id="stationFilter" name="location">
                                            <option value="all">Todas as Estações</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Analysis Type -->
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label for="analysisType" class="form-label fw-semibold text-primary">
                                            <i class="bi bi-graph-up me-1"></i>
                                            Tipo de Análise
                                        </label>
                                        <select class="form-select" id="analysisType" name="analysisType">
                                            <option value="comprehensive">Análise Completa</option>
                                            <option value="storm">Análise de Tempestades</option>
                                            <option value="temperature">Análise Térmica</option>
                                            <option value="wave">Análise de Ondas</option>
                                            <option value="wind">Análise de Ventos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Filters -->
                            <div class="row g-4 mt-2">
                                <div class="col-12">
                                    <div class="accordion" id="advancedFilters">
                                        <!-- Wave Filters -->
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#waveFilters">
                                                    <i class="bi bi-water me-2"></i>
                                                    Filtros de Ondas
                                                </button>
                                            </h2>
                                            <div id="waveFilters" class="accordion-collapse collapse" data-bs-parent="#advancedFilters">
                                                <div class="accordion-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <label class="form-label">Altura Mínima (m)</label>
                                                            <input type="number" class="form-control" name="waveHeightMin" step="0.1" placeholder="Ex: 0.5">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Altura Máxima (m)</label>
                                                            <input type="number" class="form-control" name="waveHeightMax" step="0.1" placeholder="Ex: 5.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Período Mínimo (s)</label>
                                                            <input type="number" class="form-control" name="wavePeriodMin" step="0.1" placeholder="Ex: 3.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Período Máximo (s)</label>
                                                            <input type="number" class="form-control" name="wavePeriodMax" step="0.1" placeholder="Ex: 15.0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Wind Filters -->
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#windFilters">
                                                    <i class="bi bi-wind me-2"></i>
                                                    Filtros de Vento
                                                </button>
                                            </h2>
                                            <div id="windFilters" class="accordion-collapse collapse" data-bs-parent="#advancedFilters">
                                                <div class="accordion-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <label class="form-label">Velocidade Mín. (m/s)</label>
                                                            <input type="number" class="form-control" name="windSpeedMin" step="0.1" placeholder="Ex: 2.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Velocidade Máx. (m/s)</label>
                                                            <input type="number" class="form-control" name="windSpeedMax" step="0.1" placeholder="Ex: 30.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Direção Mín. (°)</label>
                                                            <input type="number" class="form-control" name="windDirectionMin" min="0" max="360" placeholder="Ex: 0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Direção Máx. (°)</label>
                                                            <input type="number" class="form-control" name="windDirectionMax" min="0" max="360" placeholder="Ex: 360">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Temperature Filters -->
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#tempFilters">
                                                    <i class="bi bi-thermometer me-2"></i>
                                                    Filtros de Temperatura
                                                </button>
                                            </h2>
                                            <div id="tempFilters" class="accordion-collapse collapse" data-bs-parent="#advancedFilters">
                                                <div class="accordion-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <label class="form-label">Temp. Mar Mín. (°C)</label>
                                                            <input type="number" class="form-control" name="seaTemperatureMin" step="0.1" placeholder="Ex: 10.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Temp. Mar Máx. (°C)</label>
                                                            <input type="number" class="form-control" name="seaTemperatureMax" step="0.1" placeholder="Ex: 30.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Temp. Ar Mín. (°C)</label>
                                                            <input type="number" class="form-control" name="airTemperatureMin" step="0.1" placeholder="Ex: 5.0">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label">Temp. Ar Máx. (°C)</label>
                                                            <input type="number" class="form-control" name="airTemperatureMax" step="0.1" placeholder="Ex: 40.0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pressure Filters -->
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pressureFilters">
                                                    <i class="bi bi-speedometer2 me-2"></i>
                                                    Filtros de Pressão
                                                </button>
                                            </h2>
                                            <div id="pressureFilters" class="accordion-collapse collapse" data-bs-parent="#advancedFilters">
                                                <div class="accordion-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-4">
                                                            <label class="form-label">Pressão Mín. (hPa)</label>
                                                            <input type="number" class="form-control" name="pressureMin" step="0.1" placeholder="Ex: 980.0">
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label">Pressão Máx. (hPa)</label>
                                                            <input type="number" class="form-control" name="pressureMax" step="0.1" placeholder="Ex: 1040.0">
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label">Qualidade Máx.</label>
                                                            <select class="form-select" name="qcFlagMax">
                                                                <option value="">Todos</option>
                                                                <option value="0">Apenas dados válidos (0)</option>
                                                                <option value="1">Incluir dados duvidosos (≤1)</option>
                                                                <option value="2">Incluir dados ruins (≤2)</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="row mt-4">
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg me-3" id="analyzeBtn">
                                        <i class="bi bi-play-circle me-2"></i>
                                        Executar Análise
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="clearFiltersBtn">
                                        <i class="bi bi-arrow-clockwise me-2"></i>
                                        Limpar Filtros
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Results Section -->
        <div class="row" id="analysisResults" style="display: none;">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-graph-up me-2"></i>
                            Resultados da Análise
                        </h5>
                    </div>
                    <div class="card-body" id="resultsContent">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="row" id="loadingIndicator" style="display: none;">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Analisando...</span>
                </div>
                <p class="mt-3 text-muted">Processando análise dos dados...</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/analysis.js"></script>
    <style>
        .analysis-form .form-control, 
        .analysis-form .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .analysis-form .form-control:focus,
        .analysis-form .form-select:focus {
            border-color: #4e73df;
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }

        .preset-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .preset-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .preset-card.active {
            border-color: #4e73df;
            background: linear-gradient(135deg, rgba(78, 115, 223, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
        }

        .analysis-loading {
            position: relative;
            overflow: hidden;
        }        .analysis-loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #4e73df, transparent);
            animation: loadingAnimation 2s infinite;
            z-index: 1000;
        }        /* Keyframes for loading animation */
        @@keyframes loadingAnimation {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .result-metric {
            text-align: center;
            padding: 1.5rem;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8f9fc 0%, #ffffff 100%);
            border: 1px solid #e3e6f0;
            transition: all 0.3s ease;
        }

        .result-metric:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2e59d9;
        }

        .result-label {
            font-size: 0.875rem;
            color: #5a5c69;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }
    </style>
}
