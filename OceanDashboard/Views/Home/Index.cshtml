@model List<OceanData>
@{
    ViewData["Title"] = "Dashboard Oceânica";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4 text-center mb-3">Dashboard Oceânica</h1>
        </div>
        <div class="col-12">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <!-- Filtros removidos -->
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Altura das Ondas</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container dashboard-chart">
                        <canvas id="waveHeightChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">Direção das Ondas</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container dashboard-chart">
                        <canvas id="waveDirectionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">Temperatura da Água</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container dashboard-chart">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">Período das Ondas</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container dashboard-chart">
                        <canvas id="wavePeriodChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="card-title mb-0">Análise de Padrões</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3 align-items-end mb-3">
                        <div class="col-md-3">
                            <label for="patternType" class="form-label fw-bold">Tipo de Padrão</label>
                            <select id="patternType" class="form-select">
                                <option value="all" selected>Todos os padrões</option>
                                <option value="trend">Tendências</option>
                                <option value="anomaly">Anomalias</option>
                                <option value="cycle">Ciclos</option>
                                <option value="storm">Tempestades</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="dataField" class="form-label fw-bold">Campo de Dados</label>
                            <select id="dataField" class="form-select">
                                <option value="wave_height" selected>Altura das Ondas</option>
                                <option value="wave_period">Período das Ondas</option>
                                <option value="wave_direction">Direção das Ondas</option>
                                <option value="sea_temperature_c">Temperatura da Água</option>
                                <option value="air_temperature_c">Temperatura do Ar</option>
                                <option value="wind_speed_kn">Velocidade do Vento</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="windowSize" class="form-label fw-bold">Tamanho da Janela</label>
                            <select id="windowSize" class="form-select">
                                <option value="5">5 pontos</option>
                                <option value="10" selected>10 pontos</option>
                                <option value="20">20 pontos</option>
                                <option value="50">50 pontos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button id="detectPatterns" class="btn btn-primary w-100">Detectar Padrões</button>
                        </div>
                    </div>
                    
                    <div class="pattern-results mt-4" id="patternResults" style="display:none;">
                        <ul class="nav nav-tabs" id="patternTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="patterns-tab" data-bs-toggle="tab" data-bs-target="#patterns-content" type="button" role="tab">
                                    Padrões <span id="patternsCount" class="badge bg-primary">0</span>
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="storms-tab" data-bs-toggle="tab" data-bs-target="#storms-content" type="button" role="tab">
                                    Tempestades <span id="stormsCount" class="badge bg-warning text-dark">0</span>
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="anomalies-tab" data-bs-toggle="tab" data-bs-target="#anomalies-content" type="button" role="tab">
                                    Anomalias <span id="anomaliesCount" class="badge bg-danger">0</span>
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content pt-3" id="patternTabContent">
                            <!-- Patterns tab content -->
                            <div class="tab-pane fade show active" id="patterns-content" role="tabpanel">
                                <div id="patternsList" class="list-group pattern-list">
                                    <div class="text-center text-muted py-4" id="noPatternsMessage">Nenhum padrão detectado.</div>
                                </div>
                            </div>
                            
                            <!-- Storms tab content -->
                            <div class="tab-pane fade" id="storms-content" role="tabpanel">
                                <div id="stormsList" class="list-group pattern-list">
                                    <div class="text-center text-muted py-4" id="noStormsMessage">Nenhuma tempestade detectada.</div>
                                </div>
                            </div>
                            
                            <!-- Anomalies tab content -->
                            <div class="tab-pane fade" id="anomalies-content" role="tabpanel">
                                <div id="anomaliesList" class="list-group pattern-list">
                                    <div class="text-center text-muted py-4" id="noAnomaliesMessage">Nenhuma anomalia detectada.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end mt-3">
                            <button id="exportPatterns" class="btn btn-outline-secondary">
                                <i class="bi bi-file-earmark-arrow-down"></i> Exportar Padrões (CSV)
                            </button>
                        </div>
                    </div>
                    
                    <div id="patternLoader" class="text-center p-4 d-none">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-2">Analisando dados e detectando padrões...</p>
                    </div>
                    
                    <div id="patternError" class="alert alert-danger mt-3 d-none">
                        <strong>Erro!</strong> <span id="patternErrorMessage"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center bg-light">
                    <h5 class="card-title mb-0">Todos os Registos</h5>
                    <span class="badge bg-primary">Total: <span id="totalRegistos">@Model.Count</span> registos</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped table-sm align-middle" id="tabelaRegistos">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Localização</th>
                                    <th>Temperatura (°C)</th>
                                    <th>Altura (m)</th>
                                    <th>Período (s)</th>
                                    <th>Direção (°)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- O conteúdo será preenchido via JS para suportar paginação -->
                            </tbody>
                        </table>
                        <nav>
                            <ul class="pagination justify-content-center mt-3" id="paginacaoTabela"></ul>
                        </nav>
                        <div id="mensagemSemDados" class="text-center text-muted mt-3" style="display:none;">Sem registos para mostrar.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <style>
        .dashboard-chart {
            min-height: 300px;
            height: 320px;
            max-height: 350px;
            width: 100%;
        }
        .dashboard-chart canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        /* Pattern detection styles */
        .pattern-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .pattern-item {
            border-left: 4px solid #0d6efd;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .pattern-item:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        .pattern-item.trend-pattern { border-left-color: #0d6efd; }
        .pattern-item.cycle-pattern { border-left-color: #6f42c1; }
        
        .storm-item {
            border-left: 4px solid #fd7e14;
            margin-bottom: 12px;
        }
        
        .anomaly-item {
            border-left: 4px solid #dc3545;
            margin-bottom: 12px;
        }
        
        .anomaly-item.significant {
            background-color: rgba(220, 53, 69, 0.1);
        }
        
        .intensity-bar {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #0d6efd;
            margin-right: 2px;
            border-radius: 1px;
        }
        
        .severity-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .severity-indicator.low { background-color: #0d6efd; color: white; }
        .severity-indicator.moderate-low { background-color: #0dcaf0; color: black; }
        .severity-indicator.moderate { background-color: #ffc107; color: black; }
        .severity-indicator.moderate-high { background-color: #fd7e14; color: white; }
        .severity-indicator.high { background-color: #dc3545; color: white; }
    </style>
}
